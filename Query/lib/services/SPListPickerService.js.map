{"version":3,"sources":["services/SPListPickerService.ts"],"names":[],"mappings":";;AACA,8CAAkD;AAClD,8DAA0E;AAG1E,kGAAuG;AACvG,qEAAmE;AAEnE;;GAEG;AACH;IAKE;;OAEG;IACH,6BAAY,MAAyC,EAAE,WAA4B;QACjF,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC;QACpB,IAAI,CAAC,OAAO,GAAG,WAAW,CAAC;IAC7B,CAAC;IAED;;OAEG;IACI,qCAAO,GAAd;QACE,EAAE,CAAC,CAAC,6BAAW,CAAC,IAAI,KAAK,iCAAe,CAAC,KAAK,CAAC,CAAC,CAAC;YAC/C,mEAAmE;YACnE,MAAM,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;QAChC,CAAC;QACD,IAAI,CAAC,CAAC;YACJ,2EAA2E;YAC3E,IAAI,QAAQ,GAAc,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,WAAW,8CAA2C,CAAC;YAC9G,4CAA4C;YAC5C,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC;gBAChC,QAAQ,IAAI,YAAY,CAAC;gBACzB,MAAM,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;oBAC3B,KAAK,yDAA8B,CAAC,EAAE;wBACpC,QAAQ,IAAI,IAAI,CAAC;wBACjB,KAAK,CAAC;oBACR,KAAK,yDAA8B,CAAC,KAAK;wBACvC,QAAQ,IAAI,OAAO,CAAC;wBACpB,KAAK,CAAC;gBACV,CAAC;YACH,CAAC;YACD,2EAA2E;YAC3E,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,KAAK,IAAI,IAAI,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC;gBAChE,QAAQ,IAAI,+BAA+B,CAAC;gBAC5C,QAAQ,IAAI,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC;gBACpC,4DAA4D;gBAC5D,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,KAAK,KAAK,CAAC,CAAC,CAAC;oBACvC,QAAQ,IAAI,8BAA8B,CAAC;gBAC7C,CAAC;YACH,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,aAAa,KAAK,KAAK,CAAC,CAAC,CAAC;oBACvC,QAAQ,IAAI,8BAA8B,CAAC;gBAC7C,CAAC;YACH,CAAC;YACD,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,EAAE,sBAAY,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAC,QAA8B;gBACjH,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YACzB,CAAC,CAAsB,CAAC;QAC1B,CAAC;IACH,CAAC;IAED;;OAEG;IACK,6CAAe,GAAvB;QACE,MAAM,CAAC,iCAA0B,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC;YACxF,IAAM,QAAQ,GAAa;gBACzB,KAAK,EACL;oBACE,EAAE,KAAK,EAAE,eAAe,EAAE,EAAE,EAAE,sCAAsC,EAAE,YAAY,EAAE,KAAK,EAAE;oBAC3F,EAAE,KAAK,EAAE,eAAe,EAAE,EAAE,EAAE,sCAAsC,EAAE,YAAY,EAAE,KAAK,EAAE;oBAC3F,EAAE,KAAK,EAAE,iBAAiB,EAAE,EAAE,EAAE,sCAAsC,EAAE,YAAY,EAAE,KAAK,EAAE;iBAC9F;aACF,CAAC;YACF,MAAM,CAAC,QAAQ,CAAC;QAClB,CAAC,CAAsB,CAAC;IAC1B,CAAC;IACH,0BAAC;AAAD,CAvEA,AAuEC,IAAA","file":"services/SPListPickerService.js","sourcesContent":["import { SPHttpClientResponse } from '@microsoft/sp-http';\r\nimport { SPHttpClient } from '@microsoft/sp-http';\r\nimport { Environment, EnvironmentType } from '@microsoft/sp-core-library';\r\nimport { IWebPartContext } from '@microsoft/sp-webpart-base';\r\nimport { ISPLists, IPropertyFieldListPickerHostProps } from '../propertyFields/listPicker/IPropertyFieldListPickerHost';\r\nimport { PropertyFieldListPickerOrderBy } from '../propertyFields/listPicker/IPropertyFieldListPicker';\r\nimport SPListPickerMockHttpClient from './SPListPickerMockService';\r\n\r\n/**\r\n * Service implementation to get list & list items from current SharePoint site\r\n */\r\nexport default class SPListPickerService {\r\n\r\n  private context: IWebPartContext;\r\n  private props: IPropertyFieldListPickerHostProps;\r\n\r\n  /**\r\n   * Service constructor\r\n   */\r\n  constructor(_props: IPropertyFieldListPickerHostProps, pageContext: IWebPartContext) {\r\n    this.props = _props;\r\n    this.context = pageContext;\r\n  }\r\n\r\n  /**\r\n   * Gets the collection of libs in the current SharePoint site\r\n   */\r\n  public getLibs(): Promise<ISPLists> {\r\n    if (Environment.type === EnvironmentType.Local) {\r\n      // If the running environment is local, load the data from the mock\r\n      return this.getLibsFromMock();\r\n    }\r\n    else {\r\n      // If the running environment is SharePoint, request the lists REST service\r\n      let queryUrl: string = `${this.context.pageContext.web.absoluteUrl}/_api/lists?$select=Title,id,BaseTemplate`;\r\n      // Check if the orderBy property is provided\r\n      if (this.props.orderBy !== null) {\r\n        queryUrl += '&$orderby=';\r\n        switch (this.props.orderBy) {\r\n          case PropertyFieldListPickerOrderBy.Id:\r\n            queryUrl += 'Id';\r\n            break;\r\n          case PropertyFieldListPickerOrderBy.Title:\r\n            queryUrl += 'Title';\r\n            break;\r\n        }\r\n      }\r\n      // Check if the list have get filtered based on the list base template type\r\n      if (this.props.baseTemplate !== null && this.props.baseTemplate) {\r\n        queryUrl += '&$filter=BaseTemplate%20eq%20';\r\n        queryUrl += this.props.baseTemplate;\r\n        // Check if you also want to exclude hidden list in the list\r\n        if (this.props.includeHidden === false) {\r\n          queryUrl += '%20and%20Hidden%20eq%20false';\r\n        }\r\n      } else {\r\n        if (this.props.includeHidden === false) {\r\n          queryUrl += '&$filter=Hidden%20eq%20false';\r\n        }\r\n      }\r\n      return this.context.spHttpClient.get(queryUrl, SPHttpClient.configurations.v1).then((response: SPHttpClientResponse) => {\r\n        return response.json();\r\n      }) as Promise<ISPLists>;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns 3 fake SharePoint lists for the Mock mode\r\n   */\r\n  private getLibsFromMock(): Promise<ISPLists> {\r\n    return SPListPickerMockHttpClient.getLists(this.context.pageContext.web.absoluteUrl).then(() => {\r\n      const listData: ISPLists = {\r\n        value:\r\n        [\r\n          { Title: 'Mock List One', Id: '6770c83b-29e8-494b-87b6-468a2066bcc6', BaseTemplate: '109' },\r\n          { Title: 'Mock List Two', Id: '2ece98f2-cc5e-48ff-8145-badf5009754c', BaseTemplate: '109' },\r\n          { Title: 'Mock List Three', Id: 'bd5dbd33-0e8d-4e12-b289-b276e5ef79c2', BaseTemplate: '109' }\r\n        ]\r\n      };\r\n      return listData;\r\n    }) as Promise<ISPLists>;\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\src"}